{"version":3,"sources":["complianceModule1.test.js"],"names":["assert","require","ganache","Web3","fs","solc","provider","web3","bytecode","readFileSync","compInterface","bytecode1","interface1","accounts","compliance","picopsAddress","complianceAddress","picops","result1","deploy","accounts1","eth","getAccounts","Contract","JSON","parse","data","send","from","gas","options","address","console","log","arguments","setProvider","beforeEach","t","truthy","x1","methods","certify","x","isSubscriptionPermitted","call","is","y1","y","isRedemptionPermitted"],"mappings":"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","file":"complianceModule1.test.js","sourcesContent":["import test from 'ava';\nconst assert = require('assert');\nconst ganache = require('ganache-cli');\nconst Web3 = require('web3');\nconst fs = require('fs');\nconst solc = require('solc');\n\nconst provider = ganache.provider();\nconst web3 = new Web3(provider);\n\nconst bytecode = fs.readFileSync('./__contracts_ComplianceInterface_sol_ComplianceInterface.bin');\nconst compInterface = fs.readFileSync('./__contracts_ComplianceInterface_sol_ComplianceInterface.abi');\n\nconst bytecode1 = fs.readFileSync('./__contracts_SimpleCertifier_sol_SimpleCertifier.bin');\nconst interface1 = fs.readFileSync('./__contracts_SimpleCertifier_sol_SimpleCertifier.abi');\n\n\nlet accounts;\nlet compliance;\nlet picopsAddress;\nlet complianceAddress;\nlet picops;\nlet result1;\n\nconst deploy = async () => {\n    const accounts1 = await web3.eth.getAccounts();\n    result1 = await new web3.eth.Contract(JSON.parse(interface1))\n    .deploy({data : '0x' + bytecode1})\n    .send({from : accounts1[0], gas : '1000000'});\n\n    picopsAddress = result1.options.address;\n    console.log(picopsAddress);\n\n\n    compliance = await new web3.eth.Contract(JSON.parse(compInterface))\n    .deploy({data : '0x' + bytecode, arguments : [picopsAddress]})\n    .send({from : accounts1[0], gas : '6000000'});\n\n    complianceAddress = compliance.options.address;\n    console.log(complianceAddress);\n\n    compliance.setProvider(provider);\n    result1.setProvider(provider);\n  };\n\n  test.beforeEach( async t => {\n    await deploy();\n\n  });\n\n  test('deploys a contract', async t => {\n    await t.truthy(complianceAddress);\n\n  });\n\n  test('Checks if subscription is permitted', async t => {\n    const accounts = await web3.eth.getAccounts();\n    let x1 = await result1.methods.certify(accounts[0]).send({from : accounts[0]});\n    let x = await compliance.methods.isSubscriptionPermitted(accounts[0],1000000000000000000,1000000000000000000).call();\n    t.is(x,true,'subscription is permitted');\n\n  });\n\n    test('Checks if redemption permitted', async t => {\n      const accounts = await web3.eth.getAccounts();\n      let y1 = await result1.methods.certify(accounts[0]).send({from : accounts[0]});\n      let y = await compliance.methods.isRedemptionPermitted(accounts[0],1000000000000000000,1000000000000000000).call();\n      t.truthy(y);\n\n    });\n"]}